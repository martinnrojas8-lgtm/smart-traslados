<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Control - Smart Taxi</title>
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        h2 { text-align: center; color: #ffc107; text-transform: uppercase; letter-spacing: 2px; }
        
        /* SECCIÓN CONFIGURACIÓN */
        .config-box { background: #262626; border: 1px solid #444; padding: 20px; border-radius: 10px; margin-bottom: 30px; }
        .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .input-group { display: flex; flex-direction: column; }
        label { color: #ffc107; font-size: 12px; margin-bottom: 5px; }
        input, textarea { background: #333; border: 1px solid #555; color: white; padding: 10px; border-radius: 5px; }
        .btn-guardar-config { background: #ffc107; color: black; border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 15px; width: 100%; }

        /* TABLA DE CHOFERES */
        .tabla-container { overflow-x: auto; background: #262626; border-radius: 10px; padding: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border: 1px solid #333; text-align: left; font-size: 13px; }
        th { background: #333; color: #ffc107; }
        .btn-doc { background: #444; color: #ffc107; padding: 6px 10px; border: 1px solid #ffc107; border-radius: 4px; text-decoration: none; font-size: 11px; }
        .thumb-perfil { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid #ffc107; }
        .btn-aprobar { background: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="config-box">
        <h3 style="margin-top:0; color:#ffc107;">Configuración General</h3>
        <div class="config-grid">
            <div class="input-group">
                <label>Mensaje de Bienvenida / Instrucciones</label>
                <textarea id="configMensaje" rows="3" placeholder="Ej: Hola! Para activar tu cuenta transfiere $10.000..."></textarea>
            </div>
            <div class="input-group">
                <label>CBU / Alias de Cobro</label>
                <input type="text" id="configCBU" placeholder="Tu CBU o Alias">
                <label style="margin-top:10px;">Valor de la Cuota ($)</label>
                <input type="number" id="configCuota" placeholder="10000">
            </div>
        </div>
        <button class="btn-guardar-config" onclick="guardarConfiguracion()">GUARDAR CAMBIOS DEL SISTEMA</button>
    </div>

    <h2>Administración de Choferes</h2>
    
    <div class="tabla-container">
        <table>
            <thead>
                <tr>
                    <th>Perfil</th>
                    <th>Datos Personales</th>
                    <th>Vehículo</th>
                    <th>Documentación</th>
                    <th>Estado</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody id="listaChoferes"></tbody>
        </table>
    </div>

    <script>
        // Función para recuperar la configuración al entrar
        async function cargarConfiguracion() {
            try {
                // Mañana creamos la ruta en el server para esto
                const res = await fetch('/obtener-configuracion');
                const config = await res.json();
                if(config) {
                    document.getElementById('configMensaje').value = config.mensaje || "";
                    document.getElementById('configCBU').value = config.cbu || "";
                    document.getElementById('configCuota').value = config.cuota || "";
                }
            } catch (e) { console.log("Usando valores por defecto"); }
        }

        async function guardarConfiguracion() {
            const datos = {
                mensaje: document.getElementById('configMensaje').value,
                cbu: document.getElementById('configCBU').value,
                cuota: document.getElementById('configCuota').value
            };
            
            // Aquí enviaríamos al servidor mañana
            alert("Configuración guardada localmente. Mañana la conectamos al servidor.");
            localStorage.setItem('configApp', JSON.stringify(datos));
        }

        async function cargarChoferes() {
            try {
                const respuesta = await fetch('/obtener-todos-los-usuarios'); 
                const usuarios = await respuesta.json();
                const lista = document.getElementById('listaChoferes');
                lista.innerHTML = "";

                usuarios.filter(u => u.rol === 'chofer').forEach(u => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="text-align:center;"><img src="${u.foto || ''}" class="thumb-perfil"></td>
                        <td><strong>${u.nombre || 'Sin nombre'}</strong><br><small>${u.telefono}</small></td>
                        <td>${u.autoModelo || '-'}<br><small>${u.autoPatente || '-'}</small></td>
                        <td>
                            ${u.fotoCarnet ? `<a href="${u.fotoCarnet}" target="_blank" class="btn-doc">CARNET</a>` : ''}
                            ${u.fotoSeguro ? `<a href="${u.fotoSeguro}" target="_blank" class="btn-doc">SEGURO</a>` : ''}
                        </td>
                        <td><span style="color:#ffc107;">${(u.estadoRevision || 'pendiente').toUpperCase()}</span></td>
                        <td><button onclick="aprobarChofer('${u.telefono}')" class="btn-aprobar">HABILITAR</button></td>
                    `;
                    lista.appendChild(row);
                });
            } catch (error) { console.error(error); }
        }

        cargarConfiguracion();
        cargarChoferes();
    </script>
</body>
</html>
