<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Smart Traslados â€“ Mi Perfil</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{ margin:0; font-family:Arial, sans-serif; background:#000; color:#fff; display:flex; flex-direction:column; align-items:center; }
  header{ width:100%; background:#111; padding:15px; text-align:center; border-bottom:2px solid #00c853; box-sizing:border-box; }
  .container{ padding:20px; width:90%; max-width:400px; text-align:center; }
  
  .foto-perfil{ width:120px; height:120px; border-radius:50%; border:3px solid #00c853; margin:20px auto; overflow:hidden; background:#222; display:flex; align-items:center; justify-content:center; cursor:pointer; position:relative; }
  .foto-perfil img{ width:100%; height:100%; object-fit:cover; }
  .foto-perfil span{ font-size:40px; }
  
  .card{ background:#111; border-radius:15px; padding:20px; border:1px solid #333; margin-top:10px; }
  input{ width:100%; padding:12px; margin:10px 0; border-radius:8px; border:1px solid #444; background:#222; color:#fff; box-sizing:border-box; text-align:center; }
  
  button{ padding:15px; width:100%; margin-top:15px; border:none; border-radius:10px; font-weight:bold; cursor:pointer; font-size:14px; }
  .btn-save{ background:#00c853; color:#000; }
  .btn-chofer{ background:#ffb300; color:#000; margin-top:30px; border: 2px solid #ffb300; }
  .btn-back{ background:none; color:#888; text-decoration:underline; font-size:12px; }
</style>
</head>
<body>

<header>
  <h2 style="margin:0; font-size:18px;">Mi Perfil</h2>
</header>

<div class="container">
    <div class="foto-perfil" onclick="document.getElementById('fileInput').click()">
        <img id="imgPerfil" src="" style="display:none;">
        <span id="iconUser">ðŸ‘¤</span>
        <div style="position:absolute; bottom:0; background:rgba(0,200,83,0.7); width:100%; font-size:10px; padding:2px 0;">CAMBIAR</div>
    </div>
    <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="subirFoto(event)">

    <div class="card">
        <label style="font-size:12px; color:#888;">NOMBRE COMPLETO</label>
        <input type="text" id="nombre" placeholder="Â¿CÃ³mo te llamas?">
        
        <label style="font-size:12px; color:#888;">TELÃ‰FONO</label>
        <input type="text" id="telefono" disabled style="opacity:0.6;">

        <button class="btn-save" onclick="guardarPerfil()">GUARDAR CAMBIOS</button>
    </div>

    <div class="card" style="border-color:#ffb300; background: rgba(255,179,0,0.05);">
        <p style="margin:0; font-size:13px; color:#ffb300;">Â¿TenÃ©s un vehÃ­culo y querÃ©s trabajar?</p>
        <button class="btn-chofer" onclick="cambiarAModoChofer()">IR A PANEL DE CHOFER ðŸš–</button>
    </div>

    <button class="btn-back" onclick="location.href='index.html'">Volver al mapa</button>
</div>

<script>
let sesion = JSON.parse(localStorage.getItem("sesion") || "{}");

// Cargar datos actuales
window.onload = () => {
    if(!sesion.telefono) return location.href = "/";
    document.getElementById("nombre").value = sesion.nombre || "";
    document.getElementById("telefono").value = sesion.telefono;
    if(sesion.foto) {
        document.getElementById("imgPerfil").src = sesion.foto;
        document.getElementById("imgPerfil").style.display = "block";
        document.getElementById("iconUser").style.display = "none";
    }
};

function subirFoto(event) {
    const reader = new FileReader();
    reader.onload = () => {
        const base64 = reader.result;
        document.getElementById("imgPerfil").src = base64;
        document.getElementById("imgPerfil").style.display = "block";
        document.getElementById("iconUser").style.display = "none";
        sesion.foto = base64;
    };
    reader.readAsDataURL(event.target.files[0]);
}

function guardarPerfil() {
    sesion.nombre = document.getElementById("nombre").value.trim();
    if(!sesion.nombre) return alert("Por favor, ponÃ© tu nombre");
    
    localStorage.setItem("sesion", JSON.stringify(sesion));
    alert("Â¡Perfil actualizado!");
    location.href = "index.html";
}

function cambiarAModoChofer() {
    // Verificamos si tiene nombre antes de dejarlo ser chofer
    if(!sesion.nombre) {
        alert("Primero completÃ¡ tu nombre para poder trabajar.");
        return;
    }
    sesion.tipo = "chofer"; 
    localStorage.setItem("sesion", JSON.stringify(sesion));
    window.location.href = "/chofer/index.html";
}
</script>

</body>
</html>
