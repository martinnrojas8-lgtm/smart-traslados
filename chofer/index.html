<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Smart Traslados â€“ Chofer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{ margin:0; font-family:Arial, sans-serif; background:#000; color:#fff; }
  header{ background:#111; padding:10px 15px; display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #00c853; }
  .screen{ padding:15px; }
  .card{ background:#111; border-radius:12px; padding:15px; margin-bottom:15px; border:1px solid #333; }
  #map{ width:100%; height:350px; border-radius:10px; background:#222; }
  .btn-perfil{ width:40px; height:40px; border-radius:50%; border:2px solid #00c853; overflow:hidden; cursor:pointer; background:#333; display:flex; align-items:center; justify-content:center; }
  .btn-perfil img{ width:100%; height:100%; object-fit:cover; }
  button{ padding:12px; width:100%; margin-top:10px; border:none; border-radius:8px; background:#00c853; color:#000; font-weight:bold; }
  .hidden{ display:none; }
</style>
</head>
<body>

<header>
  <div style="width:40px"></div>
  <h2 style="margin:0; font-size:18px;">Smart Chofer</h2>
  <div class="btn-perfil" onclick="location.href='perfil.html'">
      <img id="fotoHeader" src="" style="display:none;">
      <span id="iconoUser">ðŸ‘¤</span>
  </div>
</header>

<div class="screen">
  <div class="card">
    <div id="map">Cargando mapa...</div>
  </div>
  <div class="card">
    <h3 id="estado">Estado: Disponible</h3>
    <div id="infoViaje">Esperando pedidos...</div>
  </div>
  <button style="background:#333; color:#aaa; font-size:11px;" onclick="localStorage.clear(); location.href='/'">CERRAR SESIÃ“N</button>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8zZaje1NKai0k2MxuQvQVW6vrRdfUIrY"></script>
<script>
const sesion = JSON.parse(localStorage.getItem("sesion") || "{}");

if (!sesion.telefono) { location.href = "/"; } 
else if (!sesion.nombre) { location.href = "/chofer/perfil.html"; }

function initMap() {
    if(sesion.foto) {
        document.getElementById("fotoHeader").src = sesion.foto;
        document.getElementById("fotoHeader").style.display = "block";
        document.getElementById("iconoUser").style.display = "none";
    }

    if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            const myPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            const map = new google.maps.Map(document.getElementById("map"), { center: myPos, zoom: 17, disableDefaultUI: true });
            new google.maps.Marker({ position: myPos, map: map, icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png' });
        });
    }
}
window.onload = initMap;
</script>
</body>
</html>
